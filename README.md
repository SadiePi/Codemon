# Codemon - A Pokémon library for Deno

Codemon is a WIP Pokémon library for Typescript using Deno. It faithfully implements
mechanics from the games, and is designed to be as easy to use as possible.

This project is still in alpha. Usage details are far from final and probably won't be perfectly consistent even within this README, but the library is already usable for basic tasks.

## Basic Usage

### Codex

The Codex acts as the Pokédex for the library, but with far more information than the games provide. It contains fully detailed information on every species, move, ability, item, and more, all with intellisense support. TODO more info

### Example Usage

```ts
// note: not yet published
import { spawn, TraditionalBattle } from "https://deno.land/x/codemon/mod.ts";
// import the Pokédex, a Codex with official Pokémon data
import P from "https://deno.land/x/codemon/codex/pokemon/index.ts";

// spawn a level 5 Charmander
const charmander = spawn({
  species: P.Species.Charmander,
  stats: { level: 5 },
})

// spawn a level 5 Squirtle
const squirtle = spawn({
  species: P.Species.Squirtle,
  stats: { level: 5 },
})

// battle!
const battle = new TraditionalBattle(charmander, squirtle);
const result = await battle.run();
const winner = result.remaining[0];
console.log(`${winner.name} wins!`);
```

### Custom Spawns

You can specify every tiny detail about the Pokémon you spawn, including their IVs, EVs, and even their nature. You can also specify custom moves, abilities, and items.

```ts
import { spawn } from "https://deno.land/x/codemon/mod.ts";
import P from "https://deno.land/x/codemon/codex/pokemon/index.ts";

const kibble = spawn({
  name: "Kibble",
  species: P.Species.Garchomp,
  gender: P.Genders.Female,
  nature: P.Natures.Adamant,
  stats: {
    level: 78,
    hp: { individualValue: 24, effortValue: 74 },
    attack: { individualValue: 12, effortValue: 190 },
    defense: { individualValue: 30, effortValue: 91 },
    specialAttack: { individualValue: 16, effortValue: 48 },
    specialDefense: { individualValue: 23, effortValue: 84 },
    speed: { individualValue: 5, effortValue: 23 },
  },
  moves: [
    P.Moves.DragonRage,
    P.Moves.DragonClaw,
    P.Moves.Outrage,
    P.Moves.Earthquake,
  ]
  ability: "hidden"
});
```

### Deciders

TODO this'll be hard to explain

## Custom Codex Entries

Let's define [Nucleon](https://pokemon-uranium.fandom.com/wiki/Nucleon), a [Nuclear-Type](https://pokemon-uranium.fandom.com/wiki/Nuclear_(type)) eeveelution from [Pokémon Uranium](https://pokemon-uranium.fandom.com/wiki/Main_Page). We'll also define a new move, [Gamma Ray](https://pokemon-uranium.fandom.com/wiki/Gamma_Ray), for Nucleon to use.

We first update the Codex's [arceus file](./ARCEUS.md) to create the boilerplate code for our our new entries. We'll be adding a new type, move, and species, so we'll add the following lines to the file:

```md
TODO
```

Then run `https://deno.land/x/codemon/src/arceus.ts` from the root of our Codex to generate/update the files.

### About the loader

The file `loader.ts` is a special file generated by the Arceus script. Its default export is used to register new entries into the Codex. It has a few functions, but the only one you need to know is `.register`, which provides placeholder constants for the Codex to point to, allowing circular references between entries. It takes two functions as parameters: the first takes in the placeholder Codex and returns the new entry, and the optional second takes in the completed Codex and runs any additional setup code, such as adding your types as weaknesses of types from another Codex. The register function itself returns the placeholder entry that will eventually be populated with the defined entry.

### Define a new Type
Define the Nuclear type from Pokémon Uranium
```ts
import { Type } from "https://deno.land/x/codemon/mod.ts";
import loader from "./loader.ts";

export const Nuclear: Type = loader.register<Type>(
  U => ({
    name: "Nuclear",
    color: "#00FF00",
    weaknesses: [
      U.Types.Normal,
      U.Types.Fire,
      U.Types.Fighting,
      U.Types.Water,
      U.Types.Flying,
      U.Types.Grass,
      U.Types.Electric,
      U.Types.Ground,
      U.Types.Psychic,
      U.Types.Rock,
      U.Types.Ice,
      U.Types.Bug,
      U.Types.Dragon,
      U.Types.Ghost,
      U.Types.Dark,
      U.Types.Steel,
      U.Types.Fairy,
      U.Types.Poison,
      U.Types.Nuclear,
    ],
    resistances: [U.Types.Nuclear],
    immunities: [],
  }),
  // add Nuclear to the weaknesses, resistances, and immunities of other types
  U => {
    addTypeRelation({
      weakness: [
        U.Types.Normal,
        U.Types.Fire,
        U.Types.Fighting,
        U.Types.Water,
        U.Types.Flying,
        U.Types.Grass,
        U.Types.Electric,
        U.Types.Ground,
        U.Types.Psychic,
        U.Types.Rock,
        U.Types.Ice,
        U.Types.Bug,
        U.Types.Dragon,
        U.Types.Ghost,
        U.Types.Dark,
        U.Types.Fairy,
        U.Types.Poison,
      ],
      resistance: [U.Types.Steel],
      // no immunities
    }, U.Types.Nuclear);
  }
);
```

### Define a new Move
Define the move [Gamma Ray](https://pokemon-uranium.fandom.com/wiki/Gamma_Ray_(move)) from Pokémon Uranium:
```ts
import { Move, power } from "https://deno.land/x/codemon/mod.ts";
import loader from "./loader.ts";

export const GammaRay: Move = loader.register<Move>(U => ({
  name: "Gamma Ray",
  description: "The user fires a blast of nuclear radiation at the enemy.",
  type: U.Types.Nuclear,
  pp: 30,
  category: "Special",
  attack: power(40),
  target: "Any Foe",
  makesContact: false
}));  
```


### Define a new Species

Define Nucleon, a Nuclear-type eeveelution, from Pokémon Uranium:
```ts
import { Species, weighted } from "https://deno.land/x/codemon/mod.ts";
import loader from "./loader.ts";

export const Nucleon: Species = loader.register(U => ({
  name: "Nucleon",
  description: "A radioactive eeveelution.",
  types: [U.Types.Nuclear],
  abilities: {
    normal: [U.Abilities.Atomize],
    hidden: U.Abilities.GeigerSense,
  },
  genders: weighted([
    [U.Genders.Male, 7],
    [U.Genders.Female, 1],
  ]),
  catchRate: 45,
  eggCycles: 120,
  height: 0.7,
  weight: 21.5,
  baseExperienceYield: 184,
  experienceGroup: U.Experience.MedFast,
  baseFriendship: 35,
  baseStats: {
    hp: 70,
    attack: 55,
    defense: 85,
    specialAttack: 115,
    specialDefense: 115,
    speed: 90,
  },
  evYields: {
    specialAttack: 1,
    specialDefense: 1,
  },
  bodyType: "Quadruped",
  learnset: {
    ...,
    9: [U.Moves.GammaRay],
    ...,
  },
  evolutions: [],
}));
```

Modify Eevee to evolve into Nucleon at level 20 when exposed to a Nuclear type:
```ts
export const Eevee: Species = loader.register(U => ({
  ...
  evolutions: [
    ...,
    {
      species: Nucleon,
      level: 20,
      partyType: U.Type.Nuclear
    },
  ],
  ...
}));
```

Alternatively, like with types, we can modify the `evolutions` property of Eevee directly while defining Nucleon:
```ts
export const Nucleon: Species = loader.register(U => ({
  ...
}, U => {
  U.Species.Eevee.evolutions.push({
    species: Nucleon,
    level: 20,
    partyType: U.Type.Nuclear
  });
}));
```

### Spawn our new Species

```ts
import { spawn } from "https://deno.land/x/codemon/mod.ts"; 
import U from "./index.ts";

const nuke = spawn({
  species: U.Species.Nucleon,
  name: "Nuke",
  stats: { level: 5 },
});

console.log(nuke.stats.hp.current);
```

## Advanced Usage

These are changes that are fully supported but will inevitably require a fork and some digging into the library's code.

### Adding a new stat

Open `src/stats.ts` and add or remove entries to either the `PermanentStats` or `BattleStats` arrays. Diligent strict typing throughout this project will then result in type errors that point you to other places you need to change. Those changes are straightforward, so I won't go into detail here (yet?). Of course, if it's a permanent stat you'll also need to give every species in your Codex a base value for your new stat.


## Contributing

I'd prefer for this to remain a mostly solo project. That said, I would appreciate bug reports and PRs to flesh out entries in `codex/pokemon/`.